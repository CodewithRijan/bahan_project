{% extends 'crowdsource_app/base.html' %}
{% block title %}
    Bahan - Home
{% endblock title %}
{% block content %}
    <div class="container my-5">
        <div id="map"></div>
    </div>
    <script>
        //    The |safe filter is necessary to render the JSON string correctly.
        const busStopsJson = '{{ bus_stops_json|safe }}';

        // 6. We must parse the JSON string into a real JavaScript object.
        const busStops = JSON.parse(busStopsJson);

                // 7. Initialize the map. We'll center it on Kathmandu (e.g., Ratna Park).
        //    Coordinates are [Latitude, Longitude]
        const map = L.map('map').setView([27.7050, 85.3180], 13); // 13 is the zoom level

        // 8. Add the map "tiles" (the actual map images) from OpenStreetMap.
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: 'Â© <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

        // 9. Now, we loop through our busStops object and create a marker for each one.
        busStops.forEach(stop => {
            const coordinates = [stop.lat, stop.lon];
            
            // Create a marker at the stop's coordinates
            const marker = L.marker(coordinates).addTo(map);
            
            // Add a simple popup (we'll replace this with your modal later)
            marker.bindPopup(`<b>${stop.name}</b>`);

            marker.on('click', () => {
            
                window.location.href="http://127.0.0.1:8000/stop/"+stop.id;

            });
        });

    </script>
{% endblock content %}
